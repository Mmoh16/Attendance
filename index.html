<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Attendance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Noto Sans Arabic & Inter Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0F9E99; /* Tropical Teal */
            --background-color: #EFE9E0; /* Soft Ivory */
        }
        body { 
            font-family: 'Noto Sans Arabic', 'Inter', sans-serif;
            background-color: var(--background-color); 
            color: #333; 
        }
        
        /* Utility classes using variables */
        .text-primary { color: var(--primary-color); }
        .bg-primary { background-color: var(--primary-color); }
        .border-primary { border-color: var(--primary-color); }
        
        .btn-primary:hover {
            background-color: var(--primary-color);
            filter: brightness(0.9);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <!-- Main Card -->
    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden border border-gray-100">
        
        <!-- Header -->
        <div class="bg-primary p-6 text-center">
            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm">
                <i class="fas fa-clipboard-check text-2xl text-white"></i>
            </div>
            <h1 class="text-2xl font-bold text-white mb-1" id="page-headline">Math Session</h1>
            <p class="text-white/90 text-sm">Please confirm your attendance</p>
        </div>

        <div class="p-6">
            
            <!-- Status Message Container -->
            <div id="status-message" class="hidden mb-4 p-3 rounded-lg text-sm font-medium"></div>

            <!-- Initial View: Attendance Form -->
            <div id="selection-form" class="space-y-4">
                <div id="main-title" class="text-center mb-2">
                    <label for="student-select" class="block text-sm font-medium text-gray-700 mb-2">Select your name</label>
                </div>

                <div class="relative">
                    <select id="student-select" class="block w-full pl-3 pr-10 py-3 text-base border-gray-300 bg-gray-50 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0F9E99] focus:border-[#0F9E99] sm:text-sm transition-shadow">
                        <option value="" disabled selected>-- Choose Name --</option>
                        <!-- Options injected by JS -->
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>

                <button id="confirm-btn" class="btn-primary bg-primary w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-bold text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#0F9E99] transition-all transform active:scale-95">
                    Confirm Attendance
                </button>
            </div>

            <!-- Success View: Zoom Info (Hidden by default) -->
            <div id="zoom-section" class="hidden text-center space-y-6 animate-fade-in">
                <div class="bg-green-50 text-green-800 p-4 rounded-lg mb-4 border border-green-100">
                    <i class="fas fa-check-circle text-green-500 text-xl mb-2 block"></i>
                    <span class="font-bold">Attendance Logged!</span>
                </div>

                <div class="space-y-4 text-left bg-gray-50 p-5 rounded-xl border border-gray-200">
                    <div>
                        <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Zoom ID</p>
                        <div class="flex items-center justify-between mt-1">
                            <span id="zoom-id" class="text-lg font-mono font-bold text-gray-800"></span>
                            <button onclick="copyToClipboard('zoom-id')" class="text-gray-400 hover:text-primary transition-colors"><i class="far fa-copy"></i></button>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-3">
                        <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Password</p>
                        <div class="flex items-center justify-between mt-1">
                            <span id="zoom-password" class="text-lg font-mono font-bold text-gray-800"></span>
                            <button onclick="copyToClipboard('zoom-password')" class="text-gray-400 hover:text-primary transition-colors"><i class="far fa-copy"></i></button>
                        </div>
                    </div>
                </div>

                <a id="zoom-link" href="#" target="_blank" class="btn-primary bg-primary block w-full py-3 px-4 rounded-lg shadow-md text-sm font-bold text-white focus:ring-2 focus:ring-offset-2 focus:ring-[#0F9E99] transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-video"></i> Join Zoom Meeting
                </a>
            </div>

        </div>
        
        <!-- Footer -->
        <div class="bg-gray-50 px-6 py-3 border-t border-gray-100 text-center">
            <p class="text-xs text-gray-400">Secure Attendance System</p>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const ATTENDANCE_WEBHOOK_URL = 'https://api.mark-attendance.com/webhook/log-attendance';

        // --- DYNAMIC DATA INJECTION ---
        // This variable is interpolated by n8n
        const classData = {"zoomInfo":{"zoomLink":"https://us06web.zoom.us/j/7577761092?pwd=4oGx7vmFBwiQbk7lNLtkW4if5zslpN.1","zoomId":"757 776 1092","zoomPassword":"ac7zhU"},"studentList":["Abdallah Mohamed Nabil","Abdelkader Ashraf Mohamed Ahmad","abdelrahman atef elliyat","Abdelrahman ayman Ibrahim","Abdelrahman mohamed hamed","Abdelrahman mohamed salah","Abdelrahmen Amr Mahmoud","abdelrhman mamdoh","Adham Hassan Saber","Adham Mohamed Salah","Ahmed Abu bakr ahmed","Ahmed Amr Ahmed","ahmed hassan ibrahem","Ahmed hassan zakaria","Ahmed Mohamed Soliman","Ahmed Waleed Ahmed Redwan","ahmedhamada","Ali Gehad Ali","Ali hazem abdelrouf","Alia hany","Alia Khaled","AlzahraaMahmoudAhmed","Anthony sherif raid","Arwa Mohamed Salah","Arwa reda alsaid abdelhalim alsharqawy","Ashrakat Mohamed Mohamed Ahmed","Asma Islam","Aya khalid badr","Aya samy mohamed","Ayten ahmed hassan Elsherif","Basmaarfat","Basmala hamdy gomaa","Basmala Hamdy Gomaa","Basmala Mohamed moha Abdelaziz Shehata","Bassant0mar","Bassem Mamdouh Rizk","Beonica bassim","Beshoy shehata","Betty Hany","Carol hany gerges","Caroline Ayman","Celia Hossam MOHAMED","Ceril sameh","Christina Ashamalla","Dina Youssef","Ebram antonious Samir","emilie esam eldabaa","Engy hanna","Ereeny Amged Aboelsoud","Ereny Ayman Atef","Ereny Osama","Eyad Ahmed Khairy","Eyad Tawfik moustafa tawfik","EyadAmin","fady atef awed","Fady Sherif Samir","Farida Amin Elhawary","Farida Sherif Nassar","Fatma Ahmed nagy","Fatma Ahmed nagy","felopatir samy aboalkhir","Ganna shaker soliman","George Emad fayez","George Magdy Mina","George Wael Gamal","Gorge osama","Habiba Ahmed","Habiba ahmed ismaiel","Habiba Ahmed Ragab","Habiba hany shaker","Habiba mohamed amer","Hala Ehab","halahazem","Halal metwlly zidan","Hamza mohamed mostafa","hana ahmed fattoh ali","Hana ibrahim lotfey","Hana Mansour Assaf","Hana tarek","Hana wael soliman","Haya Amr Mohamed","Haya mahmoud","Hazem Ayad","hazemalgzar","Hla Ali Mohamed","Hla Ali Mohamed","hussein elwardaney","Ibrahim hisham ibrahim alterri","Idrahim Khalil issa Khalil","Jana Abdelhmed Haron","Jana abdelrahim","Jana mohamed radwan","Jana Mohammed","Jana Salem","Jana Salem","Jana wael arafa","JanaElsarag","Jessica Gerges Zakaria Gayed","Jessy Amir","Jessy ibrahim Sadek","Jessy Maged mourad Zaher","John Emad","Johny Onsi Naseef Anas","Jolina","Jomana sameh ezzat","Joudy Ahmed abd elmotlab","joumana ibrahim mohamed","Joy amir shafik","Joyce David Atef","Joyce yousef","Judy Hany Rashad","Julia Toufic Jawhar","Julie hany rezk","Julie hany rezk","Jumana Ayman Mohamed","Jwana Ashraf","Kanzy rizk","Karen reda","Kenzy mohamed emad","Kenzy Mohamed kamal","Kermena Ashraf","kermena Romany","Kero Hany rasmy","Kerolos  Eid","Kerolos  Eid makram","kerolos ashraf","Khadiga Mostafa Fayez","Kiria elkomos abanoub","Lamees Ahmed bahy","LAMIS MOHAMED","Lara Sherif","Lavenya Remon samuel","Lojaen yasser hamza","Lojain mahmoud hamza","Loji Elsissy","lojin mohamed mady mohamed","Lydiagerges","Mahmoud mohsen","Makarious Ekramy Ayad","makarius akram Shokralla","Malak Ahmed mohamed","malak amer","Malak ismail Abdullah","Malak mohamed abdelhamed","Malak Mohamed Hassan Mahmoud Ahmed","Malak Mohamed Mohamed saleh","Malak Mohamed Mohamed Saleh","Malak Sayed Gouda Ibrahim","malaq tarek yusif mostafa","Malek Wael Salah","Mamdoh talat farid abd el sayed","Manar","manar_mn3m","Manwella Raafat Luke","Mariam","Mariam Ahmed Mohamed","Mariam Atef Khalil","Mariam Emad","Mariam Essam Abdelkader","Mariam Ghozil","Mariam Hatem","Mariam hisham Mohamed","Mariam Khaled Tohamy","Mariam mahmoud","Mariam Mahmoud ezz","Mariam mahmoud kamel","Mariam makram","Mariam Mohamed Ahmed","Mariam Mohamed Gholam","Mariam Saeed Shoiab","Mariam sherif el shazley","Mariam taha","Mariam wael","Mariam Zakaria mohy eldeen","Mariem Mohamed Abdelwaged","Mariem Osama taha","Marina amged","Marina sameh","Mark Michael Mamdouh","Mark micheal","Mark samaan Zakaria naseef","Mark younan boshar","marly bassem","Marly Hany Gamal Nagy Zaklama","Marola emad dorgham","Marven Ehab Farouk","Marvy hany adly","Marwa Esmail","Marwan Ibrahim Hassan Daker","Maryam Wagdy","Menna","Menna Hamada Ali Ahmed","Menna Mahmoud Dabour","menna omar","Mennatullah Talaat Abdelfattah Ibrahim Elghadar","Meray Elkess Makary","Merola Rafat Dawood","Michael Ragai Sobhi","mina ashraf saad botros","Mina Romany Ramzy","Moaaz mohammed ahmed","Moaz Ahmed Ibrahim","Mohamam Hesham Ahamad","Mohamed ahmed hassan Elsherif","Mohamed Ali Hassan Hossny","Mohamed ayman mahmoud","Mohamed gaber abdellrady ahmed","Mohamed Hussein Yousef Abo Al Haggag","Mohamed Magdy Ali","Mohamed Megahid","Mohamed Mostafa Mohamed","Mohamed Yasser Mohamed","Mohraeel osama william","Mokhtar ahmed mokhtar","Mostafa elsawaf","Mostafa hatem","Mostafa Hytham ashour Ahmed","Mostafa Moamen","Mostafa Mohamed Abdel_Aleem","Muaz Mohammed Esmat","Mutasim bellah osama","Nada Hassan Ibrahim","Nada Mohamed","Nada mohamed abdel hameed","Nancy Bemn wadie","Neamat ehab","Nezar Mohamed Mounir","Nijar Kamal","Noor Mohamed Ahmed Ali","Nora hassan hamza","Noran Abdelnaby Ramadan","Noran Abdelnaby Ramadan","Noreen hesham","Nour Aly","Nour khaled Mohamed abdelhameed","Nour Megahed","Noura hany Nassar","Nourhan Ashraf Abou Hashish","Nusayba gamal mohmed elsayed","Omar Ahmed Khairy","omar Essa omar","Omar kadry","Omar Mahmoud ali kotb","Omar Mahmoud Ali Kotp","Omar Mohamed  Khalil","Omar Mohamed shaban","passant ayman salah","Patrick jimmy shokry haven","Peter George","Peter ghaly","Peter hany Ebrahem","Peter Rafaat","Petra Basem khairy","Philopateer wahid","Raed Mosaed Nabil","Raghad","Raghad Mohamed mamdouh","RAHAF Mohamed","Rahma alaa malek","Ramez ashraf farah","Rana gamal saad","Rana gamal saad","Rana Mohamed Hussein","Rana mohamed monier","Rana shreef","Rebekah Medhat Milad","Reem yasser","Retag Ahmed Abdelatty","Retaj Mahmoud Hassan","Retaj wael abosrea","retajwael","Rokaya abo Alion","Rovan ashraf","Sahar Ahmed Maher","Salma elroby","Salma mohamed abo elkassem","Salma wael","SAMA AHMED MOHAMED EL SAYED","sama ahmed mohamed el sayed mahmoud","Sama mohammed refat","Samar Ali Sayed","Samer sameh fayez","samirah khaled farouk","Sandy sameh Mahsoub","Sara Ayman","Sarah Ayman Maher Asham","Seba mahmoud","Seif Amgad Shokry Gayed","Shahd mohammed zaher jamal","Shahesta Mo’men Mohamed","Shehab Ahmed","Sherry atef Boshra","Shnoda boles karam","Shrouk Moustafa Hamada","Steven Emad","Steven Hany","Tageldeen","Tarry wael sleem azer","Tasneem Ahmed Abd elkareem Alsayed Mohammed","Thomas  Hany Farag","Thomas Hany Farag","Wafaa Dahy said","Yara Mohamed Ahmed","Yasmine waleed mohamed","Yassen Amar ahmed ali","Yassen Yousuf","Yassin hossam eldeen Mohamed","Yassin Taha Makram","Yostina Elaisha Elia","Youanna Boules Yacoub","youmna alaa","Yousef Alaa Azazy","Yousef Asaad","Yousef Waleed Mohamed","Youssef Medhat Botros","Youssef raafat gerges","Youssef Rashed","Youssef sultan abohashime","Youssef Tamer Nabil","Youstina Ayman","Youstina monsef moneer","Zamzam Ahmed Mohamed Ahmed","Zeinab Ahmed","Zenab ahmed Mahmoud abdelhafez","اشرف عبد القادر","بيشوى ايمن سيف المسيح مجلع","حبيبه اشرف عباس","حبيبه اشرف عباس","حبيبه اشرف عباس","ديفيد جورج فاروق سعيد","رنا رضا نجيب","روان","روان احمد محمد سيد يوسف","ريتاج محمد والي","عبد الرحمن رافت زيان","عبد الرحمن محمد الداخلى","علي سيد عبد الحق","كريم اشرف ماهر","مارتن دافيد عادل حبيب","محمد ايمن ابراهيم حسين","مكاريوس اكرامى عياد","ملك محمد صبره محمد","يوسف نبيل سالم إبراهيم"],"meetingId":"1766518480295"};

        const zoomInfo = classData.zoomInfo || {};
        const meetingId = classData.meetingId || 'default_session';
        const ATTENDANCE_KEY = 'attendanceTaken_' + meetingId;

        // --- DOM ELEMENTS ---
        const studentSelect = document.getElementById('student-select');
        const confirmBtn = document.getElementById('confirm-btn');
        const zoomSection = document.getElementById('zoom-section');
        const mainTitle = document.getElementById('main-title'); 
        const selectionForm = document.getElementById('selection-form');
        const statusMsg = document.getElementById('status-message');

        // --- HELPER FUNCTIONS ---
        function showMessage(msg, type = 'error') {
            statusMsg.textContent = msg;
            // NOTE: We escaped the backticks and ${} here so they survive into the browser's JS
            statusMsg.className = `mb-4 p-3 rounded-lg text-sm font-medium ${type === 'error' ? 'bg-red-50 text-red-700 border border-red-100' : 'bg-green-50 text-green-700 border border-green-100'}`;
            statusMsg.classList.remove('hidden');
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).innerText;
            // Use legacy execCommand for iframe compatibility if navigator fails, 
            // but navigator is preferred for modern browsers.
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector(`button[onclick="copyToClipboard('${elementId}')"]`);
                const originalIcon = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => btn.innerHTML = originalIcon, 1500);
            }).catch(err => console.error('Copy failed', err));
        }

        function showZoomInfo() {
            document.getElementById('zoom-id').textContent = zoomInfo.zoomId || 'N/A';
            document.getElementById('zoom-password').textContent = zoomInfo.zoomPassword || 'N/A';
            document.getElementById('zoom-link').href = zoomInfo.zoomLink || '#';
            
            if (selectionForm) selectionForm.style.display = 'none';
            zoomSection.classList.remove('hidden');
            document.getElementById('page-headline').textContent = "Access Granted";
        }

        // --- MAIN LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const attendedName = localStorage.getItem(ATTENDANCE_KEY);
            
            if (attendedName) {
                showZoomInfo();
            } else {
                if (classData.studentList && classData.studentList.length > 0) {
                    classData.studentList.forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name;
                        studentSelect.appendChild(option);
                    });
                } else {
                    showMessage("No student list found for this session.", "error");
                    confirmBtn.disabled = true;
                    confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }
        });

        confirmBtn.addEventListener('click', async () => {
            const selectedOption = studentSelect.options[studentSelect.selectedIndex];
            
            if (!selectedOption || !selectedOption.value) {
                showMessage("Please select your name from the list.", "error");
                return;
            }

            const studentName = selectedOption.value;
            
            // UI Update: Loading State
            const originalBtnText = confirmBtn.innerHTML;
            confirmBtn.textContent = 'Verifying...';
            confirmBtn.disabled = true;
            confirmBtn.classList.add('opacity-75', 'cursor-wait');
            statusMsg.classList.add('hidden'); 

            try {
                const resp = await fetch(ATTENDANCE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: studentName }),
                });

                // Uncomment in production to enforce server check
                /*
                if (!resp.ok) {
                    throw new Error('Server returned non-OK status');
                }
                */
                
                const respText = await resp.text();
                console.log('Attendance logged:', respText);
                
                localStorage.setItem(ATTENDANCE_KEY, studentName);
                showZoomInfo();

            } catch (err) {
                console.error('Fetch error:', err);
                // For demo/offline handling
                localStorage.setItem(ATTENDANCE_KEY, studentName);
                showZoomInfo();
                
                // If you want to show error instead:
                // showMessage('Could not log attendance. Please check connection and try again.', 'error');
                // confirmBtn.innerHTML = originalBtnText;
                // confirmBtn.disabled = false;
                // confirmBtn.classList.remove('opacity-75', 'cursor-wait');
            }
        });
    </script>
</body>
</html>